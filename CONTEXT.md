# CONTEXT.md ‚Äî pred1 project
> –≠—Ç–æ—Ç —Ñ–∞–π–ª —Å–æ–¥–µ—Ä–∂–∏—Ç –ø–æ–ª–Ω—ã–π –∫–æ–Ω—Ç–µ–∫—Å—Ç —Ä–∞–∑–±–æ—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞.
> –ß–∏—Ç–∞—Ç—å –ø–µ—Ä–µ–¥ –ª—é–±—ã–º–∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è–º–∏ –≤ –º–æ–¥–µ–ª–∏ –∏–ª–∏ –ø–∞–π–ø–ª–∞–π–Ω–µ.
> –ê–∫—Ç—É–∞–ª—å–Ω–∞—è –¥–∞—Ç–∞: 2026-02-21

---

## 1. –ß—Ç–æ —ç—Ç–æ –∑–∞ –ø—Ä–æ–µ–∫—Ç

FastAPI + Postgres + APScheduler —Å–µ—Ä–≤–∏—Å –¥–ª—è value-betting –ø–∞–π–ø–ª–∞–π–Ω–∞ –ø–æ —Ñ—É—Ç–±–æ–ª—É.

**–ë–∏–∑–Ω–µ—Å-flow:**
```
ingestion –¥–∞–Ω–Ω—ã—Ö ‚Üí —Ñ–∏—á–∏ ‚Üí –ø—Ä–µ–¥–∏–∫—Ç—ã/EV ‚Üí settlement/–º–µ—Ç—Ä–∏–∫–∏ ‚Üí UI/–º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥
```

**–°—Ç–µ–∫:**
- Python 3.12, FastAPI, asyncpg, APScheduler
- Postgres (–æ—Å–Ω–æ–≤–Ω–∞—è –ë–î)
- API-Football (–∏—Å—Ç–æ—á–Ω–∏–∫ –¥–∞–Ω–Ω—ã—Ö) ‚Äî –ø–æ–¥–ø–∏—Å–∫–∞ ULTRA 75 000 requests/day
- Docker + docker-compose

---

## 2. –¢–µ–∫—É—â–∏–µ –º–µ—Ç—Ä–∏–∫–∏ –º–æ–¥–µ–ª–∏ (–Ω–∞ 2026-02-21)

### Live-–º–µ—Ç—Ä–∏–∫–∏ (production, –º–∞–ª–∞—è –≤—ã–±–æ—Ä–∫–∞):

| –†—ã–Ω–æ–∫ | Win Rate | ROI | Brier | LogLoss | Settled |
|-------|----------|-----|-------|---------|---------|
| **1X2** | 34.38% | **-2.50%** | 0.216 | 0.623 | 32 |
| **TOTAL O/U 2.5** | 51.52% | **+6.39%** | ‚Äî | ‚Äî | 99 |
| **–°–≤–æ–¥–Ω–æ (365–¥)** | 47.0% | **+3.4%** | ‚Äî | ‚Äî | ‚Äî |

### Backtest-–º–µ—Ç—Ä–∏–∫–∏ (7604 –º–∞—Ç—á–∞, 6 –ª–∏–≥, 4 —Å–µ–∑–æ–Ω–∞, Bet365 odds):

**1X2 —Ä—ã–Ω–æ–∫ ‚Äî –ù–û–í–ê–Ø –º–æ–¥–µ–ª—å (threshold=0.08, alpha=0.92, fitted coefficients):**

| –õ–∏–≥–∞ | –°—Ç–∞–≤–∫–∏ | Hit Rate | ROI | Brier | LogLoss |
|------|--------|----------|-----|-------|---------|
| Serie A (135) | 172 | ‚Äî | **+10.44%** | 0.6495 | 1.0800 |
| La Liga (140) | 203 | ‚Äî | **+7.67%** | 0.6481 | 1.0725 |
| Bundesliga (78) | 212 | ‚Äî | **+4.70%** | 0.6809 | 1.1215 |
| Primeira (94) | 114 | ‚Äî | **+1.60%** | 0.6828 | 1.1265 |
| EPL (39) | 233 | ‚Äî | **-9.32%** | 0.7084 | 1.1519 |
| Ligue 1 (61) | 208 | ‚Äî | **-7.45%** | 0.6899 | 1.1266 |
| **–ò–¢–û–ì–û 1X2** | **1142** | **41.2%** | **+0.71%** | **0.6778** | **1.1142** |

**–°—Ä–∞–≤–Ω–µ–Ω–∏–µ –º–æ–¥–µ–ª–µ–π (1X2):**

| –ú–µ—Ç—Ä–∏–∫–∞ | OLD –º–æ–¥–µ–ª—å | NEW –º–æ–¥–µ–ª—å |
|---------|------------|------------|
| –°—Ç–∞–≤–∫–∏ | 1489 | 1142 |
| Hit Rate | 41.5% | 41.2% |
| ROI | -2.01% | **+0.71%** |
| Profit (units) | -29.97 | **+8.09** |

**TOTAL —Ä—ã–Ω–æ–∫:** ROI = -6.35% –¥–ª—è –æ–±–µ–∏—Ö –º–æ–¥–µ–ª–µ–π. –ù–∞–∏–≤–Ω–∞—è Poisson-–º–æ–¥–µ–ª—å –Ω–µ –∏–º–µ–µ—Ç edge –¥–ª—è O/U 2.5 –Ω–∞ –∏—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏—Ö –¥–∞–Ω–Ω—ã—Ö. **TOTAL —Å—Ç–∞–≤–∫–∏ –æ—Ç–∫–ª—é—á–µ–Ω—ã** (`ENABLE_TOTAL_BETS=false`).

### –ü—Ä–∏–Ω—è—Ç—ã–µ —Ä–µ—à–µ–Ω–∏—è (2026-02-21):

1. **EPL (39) –∏ Ligue 1 (61):** EV threshold –ø–æ–≤—ã—à–µ–Ω –¥–æ 0.12 (`LEAGUE_EV_THRESHOLD_OVERRIDES=39:0.12,61:0.12`). –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ –º–æ–∂–Ω–æ –ø–æ–ª–Ω–æ—Å—Ç—å—é –æ—Ç–∫–ª—é—á–∏—Ç—å —á–µ—Ä–µ–∑ `LEAGUE_1X2_ENABLED=78,94,135,140`.
2. **TOTAL —Å—Ç–∞–≤–∫–∏:** –æ—Ç–∫–ª—é—á–µ–Ω—ã –≥–ª–æ–±–∞–ª—å–Ω–æ (`ENABLE_TOTAL_BETS=false`) –¥–æ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ –∞–¥–µ–∫–≤–∞—Ç–Ω–æ–π –º–æ–¥–µ–ª–∏ –¥–ª—è —Ç–æ—Ç–∞–ª–æ–≤. –ü–æ—Ä–æ–≥ `VALUE_THRESHOLD_TOTAL=0.12`.
3. **–ü—Ä–∏–±—ã–ª—å–Ω—ã–µ –ª–∏–≥–∏:** Serie A, La Liga, Bundesliga, Primeira (4 –∏–∑ 6).
4. **–£–±—ã—Ç–æ—á–Ω—ã–µ –ª–∏–≥–∏:** EPL, Ligue 1 ‚Äî –º–æ–¥–µ–ª—å –Ω–µ –∏–º–µ–µ—Ç –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ–≥–æ edge.

### –¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ —Å–∏—Å—Ç–µ–º—ã (2026-02-20):

**–ê–∫—Ç—É–∞–ª—å–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏:**
```
LEAGUE_EV_THRESHOLD_OVERRIDES=39:0.12,61:0.12
ENABLE_TOTAL_BETS=false
VALUE_THRESHOLD_1X2=0.08
VALUE_THRESHOLD_TOTAL=0.12  (—Ä–µ–∑–µ—Ä–≤ –¥–ª—è –±—É–¥—É—â–µ–≥–æ)
signal_score < 0.6 ‚Üí –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω—ã–π SKIP
```

**–ê–∫—Ç–∏–≤–Ω—ã–µ –ª–∏–≥–∏ –¥–ª—è —Å—Ç–∞–≤–æ–∫:**

| –õ–∏–≥–∞ | ROI (backtest) | –°—Ç–∞—Ç—É—Å |
|------|---------------|--------|
| Serie A (135) | +10.44% | ‚úÖ –ê–∫—Ç–∏–≤–Ω–∞ |
| La Liga (140) | +7.67% | ‚úÖ –ê–∫—Ç–∏–≤–Ω–∞ |
| Bundesliga (78) | +4.70% | ‚úÖ –ê–∫—Ç–∏–≤–Ω–∞ |
| Primeira (94) | +1.60% | ‚úÖ –ê–∫—Ç–∏–≤–Ω–∞ |
| EPL (39) | -9.32% | ‚ö†Ô∏è –ü–æ—Ä–æ–≥ 0.12 |
| Ligue 1 (61) | -7.45% | ‚ö†Ô∏è –ü–æ—Ä–æ–≥ 0.12 |
| TOTAL (–≤—Å–µ –ª–∏–≥–∏) | -6.35% | üö´ –û—Ç–∫–ª—é—á–µ–Ω—ã |

---

## 3. –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –ø–∞–π–ø–ª–∞–π–Ω–∞ build_predictions.py

### 7 —à–∞–≥–æ–≤ run():

1. **apply_elo_from_fixtures** ‚Äî —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è Elo –¥–ª—è –∑–∞–≤–µ—Ä—à—ë–Ω–Ω—ã—Ö –º–∞—Ç—á–µ–π (`:549`)
2. **_target_rows** ‚Äî —Ü–µ–ª–µ–≤—ã–µ –º–∞—Ç—á–∏ –Ω–∞ –≥–æ—Ä–∏–∑–æ–Ω—Ç–µ –¥–æ 7 –¥–Ω–µ–π (`:149`)
3. **lam_home / lam_away** ‚Äî –æ–∂–∏–¥–∞–Ω–∏—è –≥–æ–ª–æ–≤ –∏–∑ baseline + –∏–Ω–¥–µ–∫—Å–æ–≤ —Ñ–æ—Ä–º—ã/–∫–ª–∞—Å—Å–∞/venue (`:588`, `:500`)
4. **–ö–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∫–∏ lambda** ‚Äî Elo / standings / injuries (`:613`, `:623`, `:634`)
5. **–í–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç–∏** ‚Äî Poisson / Dixon-Coles / Logistic / Hybrid + power-scaling –∫–∞–ª–∏–±—Ä–æ–≤–∫–∞ (`:684`, `:698`, `:727`)
6. **EV-–æ—Ç–±–æ—Ä** ‚Äî _best_ev_selection ‚Üí BET/SKIP (`:854`, `:906`)
7. **–ó–∞–ø–∏—Å—å** ‚Äî prediction_decisions + predictions + predictions_totals (`:134`, `:988`, `:1082`)

### –ö–ª—é—á–µ–≤—ã–µ —Ñ–æ—Ä–º—É–ª—ã:

```python
# Expected Value
EV = p * odd - 1                                          # :91

# Elo-–∫–æ—Ä—Ä–µ–∫—Ü–∏—è –ª—è–º–±–¥
adj = clamp(1 + elo_diff / 1600, 0.75, 1.25)             # :58, :620
lam_home = max(0.001, lam_home * adj)
lam_away = max(0.001, lam_away / adj)

# –õ–æ–≥–∏—Å—Ç–∏—á–µ—Å–∫–∞—è –º–æ–¥–µ–ª—å (–•–ê–†–î–ö–û–î ‚Äî –Ω—É–∂–Ω–æ –∑–∞–º–µ–Ω–∏—Ç—å –Ω–∞ fitted)
z = 0.002 * elo_diff + 0.05 * xpts_diff                  # :356
p_home = sigmoid(z)
p_draw = clamp(league_draw_freq, 0.15, 0.35)  # –ü–†–û–ë–õ–ï–ú–ê: —Å—Ç–∞—Ç–∏–∫–∞

# Power-scaling –∫–∞–ª–∏–±—Ä–æ–≤–∫–∞
p'_i ‚àù p_i ^ alpha                                        # :37
```

### –õ–æ–≥–∏–∫–∞ —Ä–µ—à–µ–Ω–∏—è BET/SKIP:

```
–ö–∞–Ω–¥–∏–¥–∞—Ç—ã —Ä–∞–Ω–∂–∏—Ä—É—é—Ç—Å—è –ø–æ EV —Å —Ñ–∏–ª—å—Ç—Ä–æ–º MIN_ODD..MAX_ODD  # :99
–ë–µ—Ä—ë—Ç—Å—è –ª—É—á—à–∏–π –∫–∞–Ω–¥–∏–¥–∞—Ç –≤ –¥–∏–∞–ø–∞–∑–æ–Ω–µ                      # :75

–ê–¥–∞–ø—Ç–∏–≤–Ω—ã–π –ø–æ—Ä–æ–≥ EV –æ—Ç signal_score:
  signal_score < 0.5  ‚Üí  threshold = base + 0.05
  signal_score > 0.8  ‚Üí  threshold = base - 0.01
  –∏–Ω–∞—á–µ               ‚Üí  base                            # :790

ev > effective_threshold  ‚Üí  BET
ev <= effective_threshold ‚Üí  SKIP                        # :906

–ù–µ—Ç –∫–∞–Ω–¥–∏–¥–∞—Ç–∞ ‚Üí SKIP (no_odds / no_candidate_in_range)   # :870
```

### Totals (O/U 2.5):

```
p_over_2_5 / p_under_2_5 —Å—á–∏—Ç–∞–µ—Ç—Å—è –∏–∑ Poisson-—Å—É–º–º—ã      # :651
–í—ã–±–∏—Ä–∞–µ—Ç—Å—è –ª—É—á—à–∏–π –ø–æ EV —Å –§–ò–ö–°–ò–†–û–í–ê–ù–ù–´–ú –ø–æ—Ä–æ–≥–æ–º
  settings.value_threshold_dec                            # :1032  ‚Üê –Ω–µ–ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ!
–ü–∏—à–µ—Ç—Å—è –≤ predictions_totals                              # :1082
```

---

## 4. –î–∏–∞–≥–Ω–æ—Å—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã

### –ü—Ä–æ–±–ª–µ–º–∞ 1: –ü–µ—Ä–µ—É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å –º–æ–¥–µ–ª–∏ (–ö–†–ò–¢–ò–ß–ù–û)
- Brier = 0.216, LogLoss = 0.623 –ø—Ä–∏ 3 –∏—Å—Ö–æ–¥–∞—Ö ‚Äî –º–æ–¥–µ–ª—å —Å–ª–∏—à–∫–æ–º —É–≤–µ—Ä–µ–Ω–∞
- **–†–µ—à–µ–Ω–∏–µ:** —É–≤–µ–ª–∏—á–∏—Ç—å alpha –≤ power-scaling –¥–æ 0.7‚Äì0.85 –¥–ª—è 1X2
- –ü–æ–¥–æ–±—Ä–∞—Ç—å –æ–ø—Ç–∏–º–∞–ª—å–Ω—ã–π alpha —á–µ—Ä–µ–∑ –º–∏–Ω–∏–º–∏–∑–∞—Ü–∏—é Brier –Ω–∞ val-—Å–ø–ª–∏—Ç–µ

### –ü—Ä–æ–±–ª–µ–º–∞ 2: –ù–∏—á—å—è —Å—á–∏—Ç–∞–µ—Ç—Å—è –≥—Ä—É–±–æ (–í–ê–ñ–ù–û)
- `p_draw = clamp(league_draw_freq, 0.15..0.35)` ‚Äî —Å—Ç–∞—Ç–∏—á–µ—Å–∫–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ
- –ù–µ –∑–∞–≤–∏—Å–∏—Ç –æ—Ç –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –º–∞—Ç—á–∞ –≤–æ–æ–±—â–µ
- **–†–µ—à–µ–Ω–∏–µ:** —Å—á–∏—Ç–∞—Ç—å p_draw –∏–∑ Dixon-Coles –ø–æ–ø—Ä–∞–≤–∫–∏ rho (—É–∂–µ –µ—Å—Ç—å –≤ —Å–∏—Å—Ç–µ–º–µ)
- Dixon-Coles –∫–æ—Ä—Ä–µ–∫—Ç–∏—Ä—É–µ—Ç P(0-0) –∏ P(1-1) —á—Ç–æ –Ω–∞–ø—Ä—è–º—É—é –≤–ª–∏—è–µ—Ç –Ω–∞ –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å –Ω–∏—á—å–µ–π

### –ü—Ä–æ–±–ª–µ–º–∞ 3: EV-–ø–æ—Ä–æ–≥ —Å–ª–∏—à–∫–æ–º –º—è–≥–∫–∏–π (–í–ê–ñ–ù–û)
- –ê–¥–∞–ø—Ç–∏–≤–Ω—ã–π –¥–∏–∞–ø–∞–∑–æ–Ω base ¬± 0.01/0.05 ‚Äî —Å–ª–∏—à–∫–æ–º –º–∞–ª
- –°–∏—Å—Ç–µ–º–∞ —Å—Ç–∞–≤–∏—Ç —Ç–∞–º –≥–¥–µ –Ω–µ—Ç —Ä–µ–∞–ª—å–Ω–æ–≥–æ edge ‚Üí ROI -2.5%
- **–†–µ—à–µ–Ω–∏–µ:**
  - –ü–æ–¥–Ω—è—Ç—å –±–∞–∑–æ–≤—ã–π value_threshold –¥–ª—è 1X2 –¥–æ 0.08
  - –î–æ–±–∞–≤–∏—Ç—å —Ñ–∏–ª—å—Ç—Ä: signal_score < 0.6 ‚Üí –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω—ã–π SKIP

### –ü—Ä–æ–±–ª–µ–º–∞ 4: –•–∞—Ä–¥–∫–æ–¥ –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç–æ–≤ –ª–æ–≥–∏—Å—Ç–∏–∫–∏ (–í–ê–ñ–ù–û)
- `z = 0.002 * elo_diff + 0.05 * xpts_diff` ‚Äî –≤–∑—è—Ç—ã "–∏–∑ –≥–æ–ª–æ–≤—ã"
- –ù–µ –æ–±—É—á–µ–Ω—ã –Ω–∞ —Ä–µ–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
- **–†–µ—à–µ–Ω–∏–µ:** LogisticRegression (sklearn) –Ω–∞ –∏—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏—Ö –º–∞—Ç—á–∞—Ö
- –°–æ—Ö—Ä–∞–Ω—è—Ç—å –≤–µ—Å–∞ –≤ model_params (league_id, param_name, value)
- Fallback –Ω–∞ 0.002/0.05 –µ—Å–ª–∏ model_params –ø—É—Å—Ç–æ–π

### –ü—Ä–æ–±–ª–µ–º–∞ 5: –ù–µ—Ç –∏—Å—Ç–æ—Ä–∏—á–µ—Å–∫–æ–≥–æ xG (–í–ê–ñ–ù–û)
- –°–µ–π—á–∞—Å xG —Ç–æ–ª—å–∫–æ —Ç–µ–∫—É—â–∏–π (–∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–π –º–∞—Ç—á)
- **–†–µ—à–µ–Ω–∏–µ:** rolling mean xG –∑–∞ L5/L10 –º–∞—Ç—á–µ–π –∏–∑ hist_fixtures
- –î–æ–±–∞–≤–∏—Ç—å –≤ compute_indices.py
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –≤ lam_home/lam_away

### –ü—Ä–æ–±–ª–µ–º–∞ 6: –ù–µ–ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å –ø–æ—Ä–æ–≥–æ–≤ (–°–†–ï–î–ù–ï)
- –î–ª—è 1X2: –∞–¥–∞–ø—Ç–∏–≤–Ω—ã–π –ø–æ—Ä–æ–≥ –æ—Ç signal_score
- –î–ª—è TOTAL: —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–π value_threshold_dec
- **–†–µ—à–µ–Ω–∏–µ:** —Å–¥–µ–ª–∞—Ç—å –∞–¥–∞–ø—Ç–∏–≤–Ω—ã–π –ø–æ—Ä–æ–≥ –∏ –¥–ª—è TOTAL

### –ü—Ä–æ–±–ª–µ–º–∞ 7: –ú–∞–≥–∏—á–µ—Å–∫–∞—è –∫–æ–Ω—Å—Ç–∞–Ω—Ç–∞ Elo (–ù–ò–ó–ö–û)
- `adj = clamp(1 + elo_diff / 1600, 0.75, 1.25)` ‚Äî –¥–µ–ª–∏—Ç–µ–ª—å 1600 –Ω–µ –æ–±–æ—Å–Ω–æ–≤–∞–Ω
- **–†–µ—à–µ–Ω–∏–µ:** –ø–æ–¥–æ–±—Ä–∞—Ç—å —á–µ—Ä–µ–∑ grid search –Ω–∞ –∏—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏—Ö –¥–∞–Ω–Ω—ã—Ö

---

## 5. –ò—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏–µ –¥–∞–Ω–Ω—ã–µ ‚Äî —á—Ç–æ —Å–æ–±—Ä–∞–ª–∏

### –°–∫—Ä–∏–ø—Ç: scripts/fetch_historical.py

–ö–∞—á–∞–µ—Ç —Å api-football.com –∏ –ø–∏—à–µ—Ç –≤ –ë–î:

| –¢–∞–±–ª–∏—Ü–∞ | –°–æ–¥–µ—Ä–∂–∏–º–æ–µ |
|---------|------------|
| `hist_fixtures` | —Ä–µ–∑—É–ª—å—Ç–∞—Ç + —Å—á—ë—Ç + xG |
| `hist_statistics` | —É–¥–∞—Ä—ã, –≤–ª–∞–¥–µ–Ω–∏–µ, —É–≥–ª–æ–≤—ã–µ, xG –∏–∑ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ |
| `hist_odds` | 1X2 + O/U 2.5 (–∏—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏–µ pre-match –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç—ã) |
| `hist_events` | –≥–æ–ª—ã, –∫–∞—Ä—Ç–æ—á–∫–∏, –∑–∞–º–µ–Ω—ã |
| `hist_fetch_log` | –ø—Ä–æ–≥—Ä–µ—Å—Å –∑–∞–∫–∞—á–∫–∏ (–¥–ª—è --resume) |

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:**
```bash
--resume         –≤–æ–∑–æ–±–Ω–æ–≤–∏—Ç—å —Å –º–µ—Å—Ç–∞ –æ—Å—Ç–∞–Ω–æ–≤–∫–∏
--update-today   —Ç–æ–ª—å–∫–æ —Ç–µ–∫—É—â–∏–π —Å–µ–∑–æ–Ω, –º–∞—Ç—á–∏ –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–µ 2 –¥–Ω—è
--dry-run        –ø–æ–∫–∞–∑–∞—Ç—å –ø–ª–∞–Ω –±–µ–∑ –∑–∞–ø—Ä–æ—Å–æ–≤
--from-date      –æ—Ç –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–π –¥–∞—Ç—ã (YYYY-MM-DD)
```

**–õ–æ–≥–∏–∫–∞ —Å–µ–∑–æ–Ω–æ–≤:**
- –°–µ–∑–æ–Ω—ã: 2022, 2023, 2024, 2025 (2025 = —Å–µ–∑–æ–Ω 2025/2026)
- –¢–µ–∫—É—â–∏–π —Å–µ–∑–æ–Ω: `_current_season()` ‚Üí –º–µ—Å—è—Ü >= 7 ? –≥–æ–¥ : –≥–æ–¥-1
- –î–ª—è —Ç–µ–∫—É—â–µ–≥–æ —Å–µ–∑–æ–Ω–∞: `status=FT` + `to=2026-02-20` (–Ω–µ —Ç—è–Ω—É—Ç—å –±—É–¥—É—â–∏–µ)

**–ó–∞–ø—É—Å–∫:**
```bash
# –ü–µ—Ä–≤–∏—á–Ω–∞—è –∑–∞–∫–∞—á–∫–∞ (–æ–¥–∏–Ω —Ä–∞–∑)
python scripts/fetch_historical.py --resume

# –ï–∂–µ–¥–Ω–µ–≤–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ (cron, –ø–æ—Å–ª–µ sync_data)
0 4 * * * python /app/scripts/fetch_historical.py --update-today
```

**–û—Ü–µ–Ω–∫–∞ –∫–≤–æ—Ç—ã:**
```
8 –ª–∏–≥ √ó 4 —Å–µ–∑–æ–Ω–∞ = ~12 160 –º–∞—Ç—á–µ–π
4 –∑–∞–ø—Ä–æ—Å–∞/–º–∞—Ç—á   = ~48 640 –∑–∞–ø—Ä–æ—Å–æ–≤
–ü—Ä–∏ 75k/–¥–µ–Ω—å     = –º–µ–Ω—å—à–µ 1 –¥–Ω—è
--update-today   = ~100‚Äì300 –∑–∞–ø—Ä–æ—Å–æ–≤/–¥–µ–Ω—å
```

---

## 6. –ß—Ç–æ –Ω—É–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å (–ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç—ã)

### ‚úÖ –í—ã–ø–æ–ª–Ω–µ–Ω–æ:

- ~~scripts/train_model.py~~ ‚Äî –≥–æ—Ç–æ–≤, alpha=0.92, 33 –ø–∞—Ä–∞–º–µ—Ç—Ä–∞ –≤ model_params
- ~~scripts/backtest.py~~ ‚Äî –≥–æ—Ç–æ–≤, --compare, --accuracy-only
- ~~scripts/fetch_odds_footballdata.py~~ ‚Äî –≥–æ—Ç–æ–≤, 6700 –º–∞—Ç—á–µ–π —Å Bet365 odds
- ~~build_predictions.py: fitted –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç—ã –∏–∑ model_params~~
- ~~build_predictions.py: alpha –∏–∑ model_params~~
- ~~build_predictions.py: p_draw –∏–∑ Dixon-Coles rho~~
- ~~build_predictions.py: VALUE_THRESHOLD_1X2=0.08~~
- ~~build_predictions.py: signal_score < 0.6 ‚Üí SKIP~~
- ~~build_predictions.py: per-league EV threshold overrides~~
- ~~build_predictions.py: ENABLE_TOTAL_BETS toggle~~
- ~~compute_indices.py: rolling xG L5/L10~~

### –í—ã—Å–æ–∫–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç:

1. **–†–∞–∑—Ä–∞–±–æ—Ç–∞—Ç—å –æ—Ç–¥–µ–ª—å–Ω—É—é –º–æ–¥–µ–ª—å –¥–ª—è TOTAL (O/U 2.5)**
   - Dixon-Coles —Å –∫–æ—Ä—Ä–µ–ª—è—Ü–∏–µ–π –≥–æ–ª–æ–≤, –∏–ª–∏ XGBoost –Ω–∞ rolling stats
   - –¶–µ–ª—å: ROI > 0% —á—Ç–æ–±—ã –≤–µ—Ä–Ω—É—Ç—å TOTAL —Å—Ç–∞–≤–∫–∏
   - –ù–∞–∏–≤–Ω–∞—è Poisson-–º–æ–¥–µ–ª—å –ø–æ–∫–∞–∑–∞–ª–∞ -6.35% ROI ‚Äî –Ω–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ

2. **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ EPL –∏ Ligue 1**
   - –ï—Å–ª–∏ –∑–∞ 30 –¥–Ω–µ–π —Ä–µ–∞–ª—å–Ω—ã—Ö —Å—Ç–∞–≤–æ–∫ ROI < -5% ‚Üí –ø–æ–ª–Ω–æ—Å—Ç—å—é –æ—Ç–∫–ª—é—á–∏—Ç—å —á–µ—Ä–µ–∑ `LEAGUE_1X2_ENABLED=78,94,135,140`
   - –¢–µ–∫—É—â–∏–π –ø–æ—Ä–æ–≥ 0.12 ‚Äî –∫–æ–º–ø—Ä–æ–º–∏—Å—Å, –Ω—É–∂–Ω–æ –ø–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å live-—Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞–º–∏

### –°—Ä–µ–¥–Ω–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç:

3. **–ï–∂–µ–º–µ—Å—è—á–Ω—ã–π –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫ train_model.py**
   - –ü–æ –º–µ—Ä–µ –Ω–∞–∫–æ–ø–ª–µ–Ω–∏—è –Ω–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö —á–µ—Ä–µ–∑ `--update-today`
   - –ê–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä–æ–≤–∞—Ç—å —á–µ—Ä–µ–∑ cron –∏–ª–∏ —Ä—É—á–Ω–æ–π –∑–∞–ø—É—Å–∫ —Ä–∞–∑ –≤ –º–µ—Å—è—Ü
   - –°–ª–µ–¥–∏—Ç—å –∑–∞ –¥—Ä–µ–π—Ñ–æ–º alpha –∏ –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç–æ–≤

4. **–†–∞—Å—à–∏—Ä–∏—Ç—å –æ–±—É—á–∞—é—â—É—é –≤—ã–±–æ—Ä–∫—É**
   - –î–æ–±–∞–≤–∏—Ç—å —Å–µ–∑–æ–Ω 2021 –≤ hist_fixtures (—Å–µ–π—á–∞—Å 5859 –º–∞—Ç—á–µ–π –¥–ª—è –æ–±—É—á–µ–Ω–∏—è)
   - `python scripts/fetch_historical.py --seasons 2021 --resume`
   - –ó–∞—Ç–µ–º `python scripts/fetch_odds_footballdata.py --seasons 2021`

### –ù–∏–∑–∫–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç:

- Grid search –¥–ª—è –∫–æ–Ω—Å—Ç–∞–Ω—Ç—ã 1600 –≤ Elo-—Ñ–æ—Ä–º—É–ª–µ (backtest: 1800 —á—É—Ç—å –ª—É—á—à–µ)

---

## 7. –ü—Ä–∞–≤–∏–ª–∞ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏

- **Fallback –≤–µ–∑–¥–µ:** –µ—Å–ª–∏ model_params –ø—É—Å—Ç–æ–π ‚Äî —Å—Ç–∞—Ä—ã–µ –∫–æ–Ω—Å—Ç–∞–Ω—Ç—ã —Ä–∞–±–æ—Ç–∞—é—Ç
- **–í—Å–µ –¥–∞—Ç—ã –≤ UTC**
- **–ì—Ä–∞–Ω–∏—á–Ω–∞—è –¥–∞—Ç–∞ –¥–∞–Ω–Ω—ã—Ö:** 2026-02-20
- **–ü–æ—Å–ª–µ –ª—é–±—ã—Ö –∏–∑–º–µ–Ω–µ–Ω–∏–π:**
  ```bash
  python -m compileall -q app && pytest -q
  ```
- **–ù–µ —Ç—Ä–æ–≥–∞—Ç—å:** scripts/fetch_historical.py (—É–∂–µ –≥–æ—Ç–æ–≤)
- **–¢–µ—Å—Ç—ã** –¥–ª—è train_model –∏ rolling xG –∏–Ω–¥–µ–∫—Å–æ–≤ –≤ tests/

---

## 8. –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
app/
  jobs/
    sync_data.py          ‚Äî fixtures/odds/xG/injuries/standings
    compute_indices.py    ‚Äî L5/L15/venue/rest –∏–Ω–¥–µ–∫—Å—ã
    build_predictions.py  ‚Äî –≥–ª–∞–≤–Ω–∞—è –º–æ–¥–µ–ª—å (Poisson/Logistic/Dixon-Coles/Hybrid)
    evaluate_results.py   ‚Äî settlement + –º–µ—Ç—Ä–∏–∫–∏
  core/
    config.py             ‚Äî –∫–æ–Ω—Ñ–∏–≥/—Ñ–∏—á–µ—Ñ–ª–∞–≥–∏/cron/env
    db.py                 ‚Äî –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –ë–î
  data/
    providers/
      api_football.py     ‚Äî –ø—Ä–æ–≤–∞–π–¥–µ—Ä —Å cache/retry/budget/metrics
  ui/
    index.html / ui.css / ui.js
scripts/
  fetch_historical.py     ‚Äî ‚úÖ –≥–æ—Ç–æ–≤ (—Å–±–æ—Ä –∏—Å—Ç–æ—Ä–∏–∏ –∏–∑ API-Football)
  fetch_odds_footballdata.py ‚Äî ‚úÖ –≥–æ—Ç–æ–≤ (odds –∏–∑ football-data.co.uk)
  train_model.py          ‚Äî ‚úÖ –≥–æ—Ç–æ–≤ (LogisticRegression + alpha –ø–æ–¥–±–æ—Ä)
  backtest.py             ‚Äî ‚úÖ –≥–æ—Ç–æ–≤ (--compare, --accuracy-only)
tests/
alembic/versions/
```
